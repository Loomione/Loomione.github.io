---
layout: article
title: GFS 论文阅读
tags: 分布式 论文阅读
mode: immersive
aside:
  toc: true
---

本文为 Google 发表的[The Google File System](https://storage.googleapis.com/gweb-research2023-media/pubtools/pdf/035fc972c796d33122033a0614bc94cff1527999.pdf)论文阅读笔记，GFS（Google File System）是由Google设计并实现的为大规模分布式数据密集型应用程序设计的可伸缩（scalable）的分布式文件系统。

<!--more-->

## GFS 概述

**GFS假设**
- 设备故障是常态：GFS 假设设备故障是常态，因此设计了一套完善的容错机制，包括数据备份、自动恢复等。
- 文件是大文件：GFS 假设文件是大文件，因此设计了一套适合大文件的存储管理机制。
- 顺序读写：GFS 假设大部分的读写操作是顺序读写，因此设计了一套适合顺序读写的存储管理机制。
- 多用户并发读写：GFS 假设有多个用户并发读写文件，因此设计了一套适合多用户并发读写的存储管理机制。
- 高吞吐率比低延迟更重要：GFS 假设高吞吐率比低延迟更重要，因此设计了一套适合高吞吐率的存储管理机制。

GFS接口
: 对于客户端而言，GFS 提供了一个类似于 POSIX 的文件系统接口，包括创建、删除、打开、关闭、读、写、定位、重命名等操作。客户端只需要调用这些接口，而不需要关心底层的存储管理机制。另外，GFS 还提供了一些额外的接口，如 **snapshot(快照)**、**record append(追加记录)**。

GFS 架构
: 一个GFS集群由一个`主节点（master）`和多个`chunkserver`组成。**<font color=red>主节点负责元数据管理，chunkserver负责数据存储</font>**。客户端通过主节点获取元数据信息，然后直接与chunkserver通信进行数据读写。

<div  align="center">
<img src= "
https://pictureloomione.oss-cn-beijing.aliyuncs.com/pic/GFS%20paper/gfs%20%E6%9E%B6%E6%9E%84.png
"/>
</div>

在GFS中，文件被分为固定大小的`chunk`，`chunk`是GFS的基本存储单元，每个`chunk`的大小为64MB, `chunk`的元数据大小为64bit。`chunk`的副本数由用户指定，通常为3个。`chunk`的副本分布在不同的`chunkserver`上。

`master`负责存储GFS的元数据，元数据包括`文件和chunk的命名空间（namespace）`、`文件与chunk的映射关系`、`chunk的位置`。所有元数据都存储在master的内存中，对于前两种元数据，master会定期地将其持久化到本地磁盘上，并在**远程备份**。master不会持久化保存哪台chunkserver含有给定的chunk的副本的记录，而是简单地在启动时从chunkserver获取信息。

master还控制系统级活动如chunk`租约（chunk lease）管理`、`孤儿chunk垃圾回收`（garbage collection of orphaned chunks）和chunkserver间的`chunk迁移`（migration）。master周期性地通过心跳（HeartBeat）消息与每个chunkserver通信，向其下达指令并采集其状态信息。

在GFS中，`chunk`的大小设计为64MB，是一个比较大的值。这样做主要有下面几个优点：
1. **减少元数据的数量**：相对于小文件，`chunk`的数量会减少很多，从而减少了元数据的数量。
2. **减少网络开销**：为chunk较大，client更有可能在一个chunk上执行更多的操作，这可以通过与chunkserver保持更长时间的TCP连接来减少网络开销。
3. **减少了client与master交互的次数**：client在读写文件时，只需要与master交互一次，获取文件的元数据信息，然后直接与chunkserver通信。


但是，`chunk`较大也会带来一些问题：
1. **内部碎片**：如果一个文件的大小不是`chunk`的整数倍，那么最后一个`chunk`会有很多内部碎片。
2. **hot spot**：由于一个chunk太大，那么可能对这个`chunk`的访问频率也会很高，这样就会导致`hot spot`问题。

## 名词解释

**<font color=red>chunk</font>**
: GFS的基本存储单元，每个chunk的大小为64MB。chunk的副本数由用户指定，通常为3个。chunk的副本分布在不同的chunkserver上。

**<font color=red>chunkserver</font>**
: GFS的存储节点，负责chunk的存储、读写等操作。

**<font color=red>master</font>**
: GFS的主节点，负责元数据管理，chunk的分配、副本的管理、chunk的迁移等。

**<font color=red>chunk lease</font>**
: chunk租约，master通过租约机制来控制chunk的读写权限。master会向一个chunkserver授予一个chunk的租约，这个chunkserver就可以对这个chunk进行读写操作。

**<font color=red>garbage collection of orphaned chunks</font>**
: 孤儿chunk垃圾回收，master会定期扫描文件系统，找出不再被使用的chunk，然后通知chunkserver删除这些孤儿chunk。